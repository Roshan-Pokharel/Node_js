<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Products</title>
  <link rel="stylesheet" href="/stylesheet/output.css" />
</head>

<body class=" bg-slate-900 text-white font-medium overflow-x-hidden">

  <!-- Header -->
  <header class="flex items-center justify-between px-8 py-5 border-b border-slate-800 "> 
    <a href="/product/crud"><h1 class="md:text-2xl text-xl  font-bold tracking-wide cursor-pointer">Product List</h1></a>

 <!-- Search section start from here  -->
    <div class="absolute md:right-70 right-18 flex items-center gap-10 ">
                  <div class="relative group hidden md:block"> 
    <button id="catBtn" class="text-sm font-medium text-slate-300 hover:text-indigo-600 flex items-center gap-1 transition-colors cursor-pointer">
        Categories
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
    </button>

    <div id="catPanel" class="hidden absolute top-full mt-2 left-1/2 -translate-x-1/2 w-48 bg-white shadow-lg border border-slate-200 p-3 rounded-xl z-50">
        <% 
           let uniqueCategories = new Set(); 
           /* IMPORTANT: We use 'productData' here, not 'products', 
              because 'products' only contains what is inside the cart */
           if (typeof products !== 'undefined') {
               productData.forEach(p => uniqueCategories.add(p.category));
           }
        %>
        <div class="space-y-1">
            <% uniqueCategories.forEach(cat => { %>
                <a href="/product/<%= cat %>" class="block px-3 py-2 rounded-lg text-sm text-slate-700 hover:bg-slate-50 hover:text-indigo-600 transition">
                    <%= cat %>
                </a>
            <% }) %>
        </div>
    </div>
          </div>
      <form action="/product/searchAdmin" method="post">
        <input type="text" placeholder="Search products..." 
               class="w-64 pl-4 pr-10 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" name="search">
        <button class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1110.5 3a7.5 7.5 0 016.15 13.65z"/>
          </svg>
        </button>
                </form>
      </div>

    <a href="/admindomain"
      class=" hidden md:block bg-purple-600 hover:bg-purple-700 active:scale-95 transition  text-white md:px-4 md:py-2 py-1 px-1 rounded-md shadow-md md:absolute  md:right-40 top-5">
      Go Back
    </a>

    <a href="/product/add"
      class=" hidden md:block bg-purple-600 hover:bg-purple-700 active:scale-95 transition text-white px-1 py-1 md:px-2 md:py-2 rounded-md shadow-md ">
      Add Product
    </a>


<!-- Mobile Menu Button -->
<button class="md:hidden  text-gray-700 focus:outline-none" id="mobile-menu-product">
  <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2"
       viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 6h16M4 12h16M4 18h16"/>
  </svg>
</button>

<!-- Mobile Menu -->
   <div class="hidden md:hidden absolute right-5 top-15 bg-slate-400" id="mobile-product">
    <a href="/product/add" class="block px-6 py-2  text-gray-800 hover:bg-slate-300">Add Product</a>
    <a href="/admindomain" class="block px-6 py-2 text-gray-800 hover:bg-slate-300">Back</a>
  </div>




  </header>
<% if(products.length === 0){ %>
    <table class="min-w-full border border-slate-800 rounded-lg overflow-hidden  ">
      <thead class="bg-slate-800 text-left text-sm uppercase text-slate-300">
       <th class="px-4 py-3">No Such Products</th>
    </thead>
    </table>
<%} else { %>
  <!-- Table Container -->
  <div class="p-8  overflow-x-auto">
    
    <table class="min-w-full border border-slate-800 rounded-lg overflow-hidden  ">
      
      <!-- Table Head -->
      <thead class="bg-slate-800 text-left text-sm uppercase text-slate-300">
        <tr>
          <th class="px-4 py-3">Image</th>
          <th class="px-4 py-3">Name</th>
          <th class="px-4 py-3">Discount</th>
          <th class="px-4 py-3">Price</th>
          <th class="px-4 py-3">Description</th>
          <th class="px-4 py-3">Offer</th>
          <th class="px-4 py-3">Tag</th>
          <th class="px-4 py-3">Category</th>
          <th class="px-4 py-3">Color</th>
          <th class="px-4 py-3">Rating</th>
          <th class="px-4 py-3 text-center">Actions</th>
        </tr>
      </thead>

      <!-- Table Body -->
      <tbody>

        <% products.forEach((product)=>{ %>

        <tr class="border-t border-slate-800 hover:bg-slate-800/50 transition-colors">
          
          <!-- Image -->
          <td class="px-4 py-3">
            <% if (product.image[0] && product.image[0].data) { %>
              <img class="w-12 h-12 object-contain bg-slate-200 rounded"
                src="data:<%= product.image[0].contentType %>;base64,<%= product.image[0].data.toString('base64') %>"
                alt="<%= product.productname %>">
            <% } else { %>
              <div class="w-12 h-12 bg-slate-300 rounded"></div>
            <% } %>
          </td>

          <!-- Data Fields -->
          <td class="px-4 py-3"><%= product.productname %></td>
          <td class="px-4 py-3"><%= product.discount %> %</td>
          <td class="px-4 py-3">Rs. <%= product.price %></td>
          <td class="px-4 py-3 max-w-xs truncate"><%= product.description %></td>
          <td class="px-4 py-3"><%= product.offer %></td>
          <td class="px-4 py-3"><%= product.tag %></td>
          <td class="px-4 py-3"><%= product.category %></td>
          <td class="px-4 py-3"><%= product.colors %></td>
          <td class="px-4 py-3"><%= product.rating %></td>

          <!-- Actions -->
          <td class="px-4 py-3 flex items-center justify-center gap-2">

            <a href="/product/edit/<%= product._id %>"
              class="bg-blue-500 hover:bg-blue-600 text-white text-sm px-3 py-1 rounded-md">
              Edit
            </a>

            <form action="/product/delete/<%= product._id %>" method="POST" onsubmit="return confirm('Delete this product?')">
              <button
                class="bg-red-500 cursor-pointer hover:bg-red-600 text-white text-sm px-3 py-1 rounded-md">
                Delete
              </button>
            </form>

          </td>

        </tr>

        <% }) %>

      </tbody>
    </table>

  </div>
  <% } %>
 <script src="/javascript/productMobile.js"></script>
 <script src="/javascript/categories.js"></script>
</body>
</html>
